# Repo for team_diligent_igloo for the PRC Data Challenge

Team members: Antonio Pereira Barata, Bernard Bronmans, Victor Ciulei (teamlead), members of the Innovation and Datalab, Human Environment and Transportation Inspectorate, Ministry of Infrastructure and Water Management, Dutch Government.  

## Introduction
Welcome to the Gitlab Repo of our team. Please read this file carefully to understand the approach we took on predicting the estimate Take-Off Mass as part of the competition organized by the Performance Review Comission of EUROCONTROL. We include here detailed information about the feature engineering process, extra data we used, libraries, models. We're very happy with the work we did in 16 days of competition.

## The Why behind the Why

- Why is the challenge focusing on ATOW?
ATOW is an important input for models estimating fuel burnt and derived gaseous emissions.
The current lack of openly available ATOW is typically compensated by assuming it to be equal to a certain percentage of the Maximum TakeOff Weight (MTOW) for the relevant aircraft model.
With this challenge we aim at making available a better way to estimate ATOW, i.e. an Estimated TakeOff Weight (ETOW).

- Why an Open model?
The PRC (and many other Organizations, industrial actors and academia by the way) is interested in studies assessing the impact of Aviation to Climate Change. To this extent the availability of an open model allows for reproducibility, transparency of the results presented and in the end to trust in the performed analyses.

## Prerequisites on running the notebooks

We have worked with Python in Jupyter Notebooks. Consider running the two lines in `conda_install.txt` to install all the libraries after creating a conda environment. The notebooks were ran on the GPU machine locally, hence the use of torch and CUDA. Additionally we have worked with our own datafolder paths, those would also need to be properly selected. We parallelized some preprocessing using 12 cores on a 64 GB RAM laptop, using antything else will increase the preprocessing time (and hyperoptimization process re GPU) significantly. We advise to chunk the hyperopt search as using the entire search just takes too long. 

## Usage

If all libraries and data folders are in order, the notebooks should be ran in the order of the notebook names (except downloading the data, if the user already has it.) The notebook 000FUEL should be ran as stated in the Acropole Github

## Our approach

We decided to use an XGBoost model and performed a random search for the hyperparameter optimisation. We train the model  using a Stratified 5-Fold approach to ensure that the resulting best hyperparameters are robust for the final_submission file. The feature engineering is core to our approach and is described in the next paragraph. After preprocessing the flights and computing TAS, distances, bearing etc,  and resampling, we develop cyclic features, segment-based features, and statistical metrics. Cyclic features are extracted by mapping timestamp elements (hour of the day, day of the week, day of the month, and day of the year) onto a unit circle. This accounts for periodicity, such as daily or annual cycles, using sine and cosine transformations. Segment-based features are created by identifying segments within flights where the phase (e.g., takeoff, cruise, landing) changes, storing each phase's indices for analysis of intra- and inter-segment variability. Statistical metrics include measures such as mean, standard deviation, quantiles, and distances between waypoints. Additionally, phase-specific statistics and variability measures within quantile bins are calculated, allowing for insights into both global and segmented patterns in flight data. 

Other features types include the static ones, generated from airport and aircraft. Airport features are generated by creating a undirected graph network from the OD-pairs, and then using network measures to describe the airports. In addition we also use the bearing of the direct OD-pair, the airport elevation and runway information as raw features.
The latest version of the model uses enriched aircraft information by collating physical aicraft data from the FAA, with information of fuelflow and emissions collected from the European Emissions Databank. We use engine-specific parameters, albeit the exact engine (subtype) or modifications are not always accurately represented in our model. We also expand on the Acropole model by adding new aircraft types for the fuelflow predictions. Some aircraft information is also added from that source. In addition we add the predicted fuel flow by Acropole as one of the features of our model.

## What we didn't do

We thought that it was not in the spirit of the competition to reverse engineer the flights and uncover airlines and the aircraft registration number, even though this was possible. Such information would have led to finding out the precise engine and engine type, its age and modifications, which would potentially improve the prediction power of our model. Something we also didn't manage to test in time was whether adding engine noise information would have helped the prediction.

## Contributing

People who want to contribute are free to do so, by reusing the available code. Fork from this github and mention the authors and github whenever you make a publication. 

## Acknowledgements and thanks

We would like to thank Junzi Sun and Xavier Olive for their work put in the Traffic [1][https://traffic-viz.github.io/index.html] library specifically and making it freely available to use, as well as to Gabriel Jarry for his work on the Acropole[2][https://github.com/DGAC/Acropole] fuel flow prediction. Thank you also to the organizers of the PRC Data Challenge and those affiliated with the competition, OpenSky and EUROCONTROL for contributing to open data and open and transparent software and machine learning in aviation.

## License
This project and its accompanying files is licensed under the GNU GPLv3 license and is free to use or modify without any restrictions. Please see the accompanying GNU General Public License V3 Terms and Conditions in the file called LICENSE.txt



